<div class="space-y-4">
    <h3 class="text-sm font-bold text-sky-400 uppercase ml-1 flex items-center">
        <i class="fas fa-credit-card mr-2"></i> Faturas de Cartão
    </h3>

    {# Define se estamos vendo o mês atual #}
    {% set is_current_view = (current_month == today.month and current_year == today.year) %}
    
    {% for card in cards_data %}
    <div class="bg-slate-800 rounded-lg border {% if card.is_paid %}border-emerald-500/30{% else %}border-sky-500/30{% endif %} overflow-hidden shadow-lg transition hover:border-sky-500/60">
        <div class="p-4">
            <div class="flex justify-between items-start mb-2">
                <div>
                    <h4 class="text-white font-bold text-lg">{{ card.obj.name }}</h4>
                    <div class="text-xs text-slate-400 mt-1 space-y-0.5">
                        <p class="flex items-center">
                            <i class="far fa-calendar-alt mr-1.5 w-3"></i> 
                            Vencimento: <span class="text-slate-200 ml-1 font-medium">{{ card.full_due_date }}</span>
                        </p>
                        <p class="flex items-center">
                            <i class="fas fa-lock mr-1.5 w-3"></i> 
                            Fechamento: <span class="text-slate-200 ml-1 font-medium">{{ card.full_closing_date }}</span>
                        </p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="text-xs text-slate-400 uppercase font-bold mb-1">Valor da Fatura</p>
                    <p class="text-xl font-bold {% if card.is_paid %}text-emerald-400{% else %}text-white{% endif %}">
                        R$ {{ "%.2f"|format(card.invoice_amount)|replace('.', ',') }}
                    </p>
                    {% if card.is_paid %}
                        <span class="inline-block mt-1 px-2 py-0.5 rounded text-[10px] font-bold bg-emerald-900/30 text-emerald-400 border border-emerald-900/50">PAGA</span>
                    {% else %}
                        <span class="inline-block mt-1 px-2 py-0.5 rounded text-[10px] font-bold bg-sky-900/30 text-sky-300 border border-sky-900/50">ABERTA</span>
                    {% endif %}
                </div>
            </div>

            <div class="mt-4 mb-4">
                <div class="flex justify-between text-xs mb-1">
                    <span class="text-slate-400">Limite Utilizado ({{ "%.0f"|format(card.percent) }}%)</span>
                    <span class="text-slate-300">R$ {{ "%.2f"|format(card.used)|replace('.', ',') }} / {{ "%.0f"|format(card.limit)|replace('.', ',') }}</span>
                </div>
                <div class="w-full bg-slate-700 rounded-full h-2">
                    <div class="bg-sky-500 h-2 rounded-full transition-all duration-500" style="width: {{ card.percent }}%"></div>
                </div>
                <div class="mt-1 text-right">
                    <span class="text-[10px] text-slate-500">Disponível: <span class="text-slate-300">R$ {{ "%.2f"|format(card.available)|replace('.', ',') }}</span></span>
                </div>
            </div>

            <div class="pt-3 border-t border-slate-700 flex justify-between items-center">
                {% if card.is_paid %}
                    <span class="text-emerald-500 text-xs font-bold flex items-center">
                        <i class="fas fa-check-circle mr-1"></i> Fatura Paga / Zerada
                    </span>
                    <button onclick="openAdvanceModal('{{ card.obj.id }}', '{{ card.obj.name }}')" 
                            class="text-slate-400 hover:text-white text-xs underline disabled:opacity-30 disabled:cursor-not-allowed"
                            {% if not is_current_view %}disabled title="Disponível apenas no mês atual"{% endif %}>
                        Antecipar Parcelas
                    </button>
                {% else %}
                    <span class="text-sky-400 text-xs font-bold mr-auto flex items-center">
                        <i class="fas fa-clock mr-1"></i> Pendente
                    </span>
                    
                    <button onclick="openAdvanceModal('{{ card.obj.id }}', '{{ card.obj.name }}')" 
                            class="bg-slate-700 hover:bg-slate-600 text-slate-200 text-xs font-bold py-1.5 px-3 rounded transition mr-2 disabled:opacity-30 disabled:cursor-not-allowed"
                            {% if not is_current_view %}disabled title="Disponível apenas no mês atual"{% endif %}>
                        Adiantar
                    </button>

                    <button onclick="openPayCardModal('{{ card.obj.id }}', '{{ card.obj.name }}', '{{ card.invoice_amount }}')" 
                            class="bg-slate-700 hover:bg-slate-600 text-white text-xs font-bold py-1.5 px-3 rounded transition shadow border border-slate-600 disabled:opacity-30 disabled:cursor-not-allowed"
                            {% if not is_current_view %}disabled title="Disponível apenas no mês atual"{% endif %}>
                        Pagar
                    </button>
                {% endif %}
            </div>
        </div>
    </div>
    {% else %}
    <div class="p-4 bg-slate-800 rounded border border-slate-700 text-center text-slate-500 text-sm">
        Nenhum cartão cadastrado.
    </div>
    {% endfor %}
</div>