<div class="bg-slate-800 rounded-lg border border-slate-700 shadow-xl overflow-hidden flex flex-col h-full">
    <div class="overflow-x-auto flex-1">
        <table class="w-full text-left border-collapse" id="transactions-table">
            <thead>
                <tr class="bg-slate-900 border-b border-slate-700 text-xs font-semibold text-slate-400 uppercase tracking-wider">
                    <th class="pl-4 pr-2 py-3 w-auto min-w-[140px]">Descrição</th>
                    
                    <th class="px-2 py-3 whitespace-nowrap hidden sm:table-cell">Categoria</th>
                    
                    <th class="px-2 py-3 text-center whitespace-nowrap cursor-pointer group hover:text-white transition" onclick="sortTransactions()">
                        <div class="flex items-center justify-center">
                            <span>Data</span>
                            <div class="ml-1 flex flex-col space-y-[2px]">
                                <i class="fas fa-caret-up text-[10px] text-slate-600 group-hover:text-slate-400" id="sort-asc"></i>
                                <i class="fas fa-caret-down text-[10px] text-slate-600 group-hover:text-slate-400" id="sort-desc"></i>
                            </div>
                        </div>
                    </th>

                    <th class="px-2 py-3 text-right whitespace-nowrap">Valor</th>
                    <th class="px-2 py-3 text-center whitespace-nowrap pr-4">Ações</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-slate-700" id="transactions-body">
                {% for t in transactions %}
                <tr class="hover:bg-slate-750 transition-colors duration-150 group {% if t.is_scheduled %}opacity-75{% endif %}" 
                    data-timestamp="{{ t.date.strftime('%Y%m%d') }}{{ t.created_at.strftime('%H%M') }}">
                    
                    <td class="pl-4 pr-2 py-3">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-8 w-8 rounded-full flex items-center justify-center 
                                {% if t.type == 'receita' %}bg-emerald-900/50 text-emerald-400
                                {% elif t.type == 'despesa' %}bg-red-900/50 text-red-400
                                {% else %}bg-blue-900/50 text-blue-400{% endif %}">
                                <i class="fas text-xs
                                    {% if t.type == 'receita' %}fa-arrow-up
                                    {% elif t.type == 'despesa' %}fa-arrow-down
                                    {% else %}fa-exchange-alt{% endif %}"></i>
                            </div>
                            <div class="ml-3 min-w-0 flex-1">
                                <div class="text-sm font-medium text-white group-hover:text-sky-300 transition-colors truncate max-w-[150px] sm:max-w-[200px] lg:max-w-[180px] xl:max-w-xs" 
                                     title="{{ t.description }}">
                                    {% if '(Ref:' in t.description %}
                                        {{ t.description.split('(Ref:')[0] }}
                                    {% else %}
                                        {{ t.description }}
                                    {% endif %}
                                </div>
                                <div class="text-[10px] text-slate-500 mt-0.5 truncate">
                                    {% if t.account_id %}{{ t.account.name }}{% endif %}
                                    {% if t.card_id %}{{ t.card.name }}{% endif %}
                                    {% if t.installment_total and t.installment_total > 1 %}
                                        <span class="ml-1 text-sky-400">({{ t.installment_current }}/{{ t.installment_total }})</span>
                                    {% endif %}
                                    {% if '(Ref:' in t.description %}
                                        <span class="ml-1 text-slate-600">Ref: {{ t.description.split('(Ref:')[1].replace(')', '') }}</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </td>

                    <td class="px-2 py-3 whitespace-nowrap hidden sm:table-cell">
                        {% if t.category %}
                        <span class="inline-flex items-center px-2 py-0.5 rounded-md text-[10px] font-medium border truncate max-w-[100px]"
                              style="background-color: {{ t.category.color_hex }}15; color: {{ t.category.color_hex }}; border-color: {{ t.category.color_hex }}30;">
                            {{ t.category.name }}
                        </span>
                        {% else %}
                        <span class="text-slate-500 text-xs">-</span>
                        {% endif %}
                    </td>

                    <td class="px-2 py-3 text-center whitespace-nowrap">
                        <div class="text-xs text-slate-300 font-medium">{{ t.date.strftime('%d/%m') }}</div>
                        <div class="text-[10px] text-slate-500">{{ t.date.strftime('%Y') }}</div>
                    </td>

                    <td class="px-2 py-3 text-right whitespace-nowrap">
                        <span class="font-bold font-mono text-sm
                            {% if t.type == 'receita' or t.type == 'transf_entrada' %}text-emerald-400
                            {% else %}text-red-400{% endif %}">
                            R$ {{ "%.2f"|format(t.amount)|replace('.', ',') }}
                        </span>
                    </td>

                    <td class="px-2 py-3 text-center whitespace-nowrap pr-4">
                        <div class="flex justify-center space-x-2">
                            
                            {# Antecipar #}
                            {% if t.is_scheduled and (t.fixed_expense_id or t.fixed_revenue_id) %}
                                {% if t.is_locked_anticipate %}
                                    <span class="text-slate-700 cursor-not-allowed p-1"><i class="fas fa-clock text-xs"></i></span>
                                {% else %}
                                    <a href="{{ url_for('finance.anticipate_fixed', id=t.id) }}" 
                                       class="text-yellow-600 hover:text-yellow-400 transition p-1" 
                                       title="Antecipar">
                                        <i class="fas fa-history text-xs"></i>
                                    </a>
                                {% endif %}
                            {% endif %}

                            {# Editar #}
                            <button type="button" 
                                    data-id="{{ t.id }}"
                                    data-desc="{{ t.description }}"
                                    data-amount="{{ t.amount }}"
                                    data-date="{{ t.date }}"
                                    onclick="openEditTransaction(this)" 
                                    class="text-blue-600 hover:text-blue-400 transition p-1" 
                                    title="Editar">
                                <i class="fas fa-pen text-xs"></i>
                            </button>

                            {# Excluir #}
                            {% if t.installment_total and t.installment_total > 1 and t.date > today %}
                                <span class="text-slate-700 cursor-not-allowed p-1"><i class="fas fa-trash text-xs"></i></span>
                            {% elif (t.fixed_expense_id or t.fixed_revenue_id) and not t.card_id %}
                                <span class="text-slate-700 cursor-not-allowed p-1" title="Use o painel de Fixos"><i class="fas fa-trash text-xs"></i></span>
                            {% else %}
                                <button type="button"
                                   onclick="openDeleteModal('{{ url_for('finance.delete_transaction', id=t.id) }}', 'Confirmar exclusão?')" 
                                   class="text-red-600 hover:text-red-400 transition p-1" 
                                   title="Excluir">
                                    <i class="fas fa-trash text-xs"></i>
                                </button>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" class="px-6 py-10 text-center text-slate-500">
                        <div class="flex flex-col items-center">
                            <i class="fas fa-inbox text-3xl mb-2 opacity-30"></i>
                            <p class="text-sm">Sem lançamentos.</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>